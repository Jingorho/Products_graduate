2020.03.21
# interpBlink.py / interpBlink.ipynb
データファイル(非公開)に対して、瞳孔径データの1次線形補間および移動平均による平滑化を行うスクリプトです。


# 使い方

## 実行環境
- OS : macOS Mojave v10.14.4
- Python3 [動作確認済 v3.6.6/v3.7.2] または Jupyter Notebook

## ディレクトリ構成
以下のように、データを保存したディレクトリと同じ場所にスクリプトを置いた状態で動作します（この場合は、データを保存するディレクトリを`data`という名前としています）。
- ご自身のワーキングディレクトリ
	- data
		- 1.csv
		- 2.csv
		- ...
	- Pythonスクリプト `interpBlink.py`

## 実行方法
- `interpBlink.py` (デフォルトのPython3)の場合
	1. `interpBlink.py`を上記「ディレクトリ構成」の指定の通りの場所に置く
	2. ターミナル上でご自身のワーキングディレクトリに移動する. 例えばデスクトップ上の`"瞳孔径データ"`という名前のディレクトリだったら<br>
		```$ cd /Users/ユーザ名/Desktop/瞳孔径データ```
	3. pythonスクリプトを実行する<br>
		```$ python3 interpBlink.py```

	(注意)
	プロットの表示が別ウインドウで開いて鬱陶しいので、`interpBlink.py`版はplotをimgディレクトリに画像として保存する仕様にしています。プロットが必要であればコメントアウトを外して実行してください。その場合、1回1回別ウインドウで表示される図を閉じる必要があります。



## 想定されるエラー
たまに、データの最初に文字列('sy'とかいうやつ)が含まれていることがあるようです。例外処理をサボったので、もし実行が途中で止まって以下のようなエラーが出る場合は、<br>
```ValueError: could not convert string to float: 'sy'```<br>
エラーが出ているcsvファイル(エラー周辺のログにパスが出力されます)をExcelとかで開いて、'sy'を消して、そのセルを空欄のまま上書き保存してください。NaNとして補間処理されるようになります。


## その他カスタム実行方法
- **移動平均幅を変えたい**<br>
main関数内、20行目あたりにある`windowWidth`の値を変えて実行してください。

- `"data"`ディレクトリ全体ではなく、**とりあえず一つのcsvファイルだけに対して実行したい**<br>
main関数内の<br>
`#[A](デバッグ用) 特定のcsvファイル一つだけを実行する場合はこちら`<br>
の後の2行のコメントアウトを外して、`SpecificCsvFile`に実行したいcsvファイルのパスを書き換えて、<br>
`# [B] このスクリプトが置かれた場所からファイルを探索して信号処理を行う`<br>
の後の1行をコメントアウトして実行してください。

```Python
    # [A] (デバッグ用) 特定のcsvファイル一つだけを実行する場合はこちら
    SpecificCsvFile = "data/5.csv"
    MakeInterpolatedCsv(SpecificCsvFile, windowWidth)

    # [B] このスクリプトが置かれた場所からファイルを探索して信号処理を行う
    # LoopProcessDir(windowWidth)
```




# やっていること
- 1次線形補間<br>
pandasパッケージに含まれているデータ処理関数`interpolate()`を使っています。

- 移動平均による平滑化<br>
pandasパッケージに含まれているデータ処理関数`rolling()`を使っています。

- 移動平均に応じて生じた`NaN`<br>
データ列全体の平均値で埋めています。


# 出力されるもの
- 線形補間後のデータをプロットしたグラフ<br>
元データを<span style="color: orange; ">オレンジ</span>で、線形補間後のデータを<span style="color: green; ">緑</span>で、移動平均での平滑化後のデータを<span style="color: blue; ">青</span>で描画しています（`img`ディレクトリ内）。画像が小さくて潰れちゃってるかも。細かく見たい場合は、Excelでグラフ描画した方が便利。

- 線形補間後のデータのcsvファイル<br>
線形補間および移動平均での平滑化後のデータを、`元データと同じid番号_pd.csv`という名前で出力しています（`processed`ディレクトリ内）。




