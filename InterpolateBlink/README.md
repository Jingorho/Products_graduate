2018.12.27
# interpBlink.py / interpBlink.ipynb
`"視線データ"`というデータファイル(非公開)に対して、瞳孔径データの1次線形補間および移動平均による平滑化を行うスクリプトです。


# 使い方

## 実行環境
- OS : macOS Mojave v10.14
- Python3 [動作確認済 v3.6.6/v3.7.2] または Jupyter Notebook

## ディレクトリ構成
以下のように、`"視線データ"`というディレクトリと同じ場所にスクリプトを置いた状態で動作します。
- ご自身のワーキングディレクトリ
	- `"視線データ"`
		- 1205_2_2
		- 1207_1_1
		- ...
	- Pythonスクリプト `interpBlink.py`または`interpBlink.ipynb`

## 実行方法
- `interpBlink.py` (デフォルトのPython3)の場合
	1. `interpBlink.py`を上記「ディレクトリ構成」の指定の通りの場所に置く
	2. ターミナル上でご自身のワーキングディレクトリに移動する. 例えばデスクトップ上の`"瞳孔径データ"`というディレクトリだったら
		```$ cd /Users/ユーザ名/Desktop/瞳孔径データ```
	3. pythonスクリプトを実行する
		```$ python3 interpBlink.py```

	(注意)
	プロットの表示が別ウインドウで開いて鬱陶しいので、`interpBlink.py`版はplotをimgディレクトリに画像として保存する仕様にしています。プロットが必要であればコメントアウトを外して実行してください。その場合、1回1回別ウインドウで表示される図を閉じる必要があります。


- `interpBlink.ipynb` (Jupyter Notebook)の場合
	1. `interpBlink.ipynb`を上記「ディレクトリ構成」の指定の通りの場所に置く
	2. ターミナル上でご自身のワーキングディレクトリに移動する. 例えばデスクトップ上の`"瞳孔径データ"`というディレクトリだったら
		```$ cd /Users/ユーザ名/Desktop/瞳孔径データ```
	3. Jupyter Notebookを起動する
		```$ jupyter nootebook```
	4. ブラウザ上で開いたJupyter Notebookを実行する(Runボタンか、Control+Enterキー)


## 想定されるエラー
たまに、データの最初に文字列('sy'とかいうやつ)が含まれていることがあるようです。例外処理をサボったので、もし実行が途中で止まって以下のようなエラーが出る場合は、<br>
```ValueError: could not convert string to float: 'sy'```<br>
エラーが出ているcsvファイル(エラー周辺のログにパスが出力されます)をExcelとかで開いて、'sy'を消して、そのセルを空欄のまま上書き保存してください。NaNとして補間処理されるようになります。


## その他カスタム実行方法
- **移動平均幅を変えたい**<br>
main関数内、20行目あたりにある`windowWidth`の値を変えて実行してください。

- `"視線データ"`ディレクトリ全体ではなく、**とりあえず一つのcsvファイルだけに対して実行したい**<br>
main関数内の<br>
`#[A](デバッグ用) 特定のcsvファイル一つだけを実行する場合はこちら`<br>
の後の2行のコメントアウトを外して、`SpecificCsvFile`に実行したいcsvファイルのパスを書き換えて、<br>
`# [B] このスクリプトが置かれた場所からファイルを探索して信号処理を行う`<br>
の後の1行をコメントアウトして実行してください。

```Python
    # [A] (デバッグ用) 特定のcsvファイル一つだけを実行する場合はこちら
    SpecificCsvFile = "視線データ/1211_1_1/bd/bd5.csv"
    MakeInterpolatedCsv(SpecificCsvFile, windowWidth)

    # [B] このスクリプトが置かれた場所からファイルを探索して信号処理を行う
    # LoopProcessDir(windowWidth)
```




# やっていること
- 1次線形補間<br>
pandasパッケージに含まれているデータ処理関数`interpolate()`を使っています。

- 移動平均による平滑化<br>
pandasパッケージに含まれているデータ処理関数`rolling()`を使っています。

- 移動平均に応じて生じた`NaN`<br>
データ列全体の平均値で埋めています。





